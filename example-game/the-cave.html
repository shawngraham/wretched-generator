<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="You are Dr. Elisabeth Blackwood, excavating a mysterious cave in 1924. Can you survive the discovery?">
    <meta name="author" content="Shawn Graham">
    <meta name="generator" content="Wretched & Alone Game Generator">
    <title>The Cave - An Archaeological Mystery</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson Text:wght@400,600&family=IM Fell English:wght@400&family=Cinzel:wght@400,600&display=swap');

:root {
  --color-primary: #2c2416;
  --color-secondary: #1a1410;
  --color-tertiary: #3a2f1f;
  --color-accent_primary: #d4af37;
  --color-accent_secondary: #8b6f47;
  --color-text_primary: #e8dcc4;
  --color-text_secondary: #b8936f;
  --color-text_tertiary: #8b7355;
  --color-borders: #8b6f47;
  --color-shadows: rgba(0,0,0,0.6);
  --color-success: #4ade80;
  --color-warning: #fbbf24;
  --color-danger: #ef4444;
  --color-info: #60a5fa;
  --color-suits-spades: #4a4a4a;
  --color-suits-hearts: #c41e3a;
  --color-suits-diamonds: #0066cc;
  --color-suits-clubs: #006400;
  --color-hover: #9b7f57;
  --color-active: #7b6447;
  --color-disabled: rgba(255,255,255,0.3);
  --font-title: 'IM Fell English', serif;
  --font-body: 'Crimson Text', serif;
  --font-ui: 'Crimson Text', serif;
  --font-monospace: 'Courier New', monospace;
}


* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--font-body);
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    color: var(--color-text_primary);
    min-height: 100vh;
    padding: 20px;
    position: relative;
    overflow-x: hidden;
}

h1, h2, h3 {
    font-family: var(--font-title);
    color: var(--color-accent_primary);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

h1 { font-size: 3em; text-align: center; margin-bottom: 10px; letter-spacing: 2px; }
h2 { font-size: 2em; margin-bottom: 15px; }
h3 { font-size: 1.5em; margin-bottom: 12px; }

.container {
    max-width: 1600px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 400px 1fr;
    gap: 30px;
    position: relative;
    z-index: 1;
}

.panel {
    background: linear-gradient(135deg, var(--color-tertiary) 0%, var(--color-secondary) 100%);
    border: 3px solid var(--color-borders);
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.6);
}

.section {
    background: rgba(42, 31, 20, 0.6);
    border: 1px solid var(--color-borders);
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
}

button {
    background: linear-gradient(135deg, var(--color-borders) 0%, var(--color-secondary) 100%);
    color: var(--color-text_primary);
    border: 2px solid var(--color-accent_primary);
    padding: 12px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-family: var(--font-ui);
    font-size: 1em;
    font-weight: 600;
    transition: all 0.3s ease;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.4);
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

textarea {
    width: 100%;
    min-height: 400px;
    background: rgba(42, 31, 20, 0.4);
    color: var(--color-text_primary);
    border: 2px solid var(--color-borders);
    border-radius: 8px;
    padding: 20px;
    font-family: var(--font-body);
    font-size: 1.1em;
    line-height: 1.8;
    resize: vertical;
}

.die {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #f5e6d3 0%, #e8dcc4 100%);
    border: 3px solid var(--color-borders);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    font-weight: bold;
    color: #2a1f14;
    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    transition: transform 0.6s ease;
}

.die.rolling {
    animation: diceRoll 0.6s ease-in-out;
}

@keyframes diceRoll {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(90deg) scale(1.1); }
    50% { transform: rotate(180deg) scale(1.05); }
    75% { transform: rotate(270deg) scale(1.1); }
}

.dice-container {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin: 15px 0;
}

.card-display {
    background: rgba(42, 31, 20, 0.8);
    border: 2px solid var(--color-accent_primary);
    border-radius: 8px;
    padding: 20px;
    margin: 15px 0;
    min-height: 100px;
}

.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(4px);
    z-index: 1000;
    padding: 20px;
    overflow-y: auto;
}

.modal-overlay.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: linear-gradient(135deg, var(--color-tertiary) 0%, var(--color-secondary) 100%);
    border: 3px solid var(--color-borders);
    border-radius: 12px;
    padding: 40px;
    max-width: 800px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    position: relative;
}

.modal-close {
    position: absolute;
    top: 10px;
    right: 10px;
    background: transparent;
    border: none;
    font-size: 30px;
    color: var(--color-accent_primary);
    cursor: pointer;
    padding: 5px 10px;
}

/* Card Examination Enhancements */
.card-pending {
    animation: cardGlow 2s ease-in-out infinite;
}

@keyframes cardGlow {
    0%, 100% { box-shadow: 0 0 10px rgba(212, 175, 55, 0.3); }
    50% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.6); }
}

/* Tension/Stability Visual Bar */
.stability-bar {
    width: 100%;
    height: 20px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 10px;
    overflow: hidden;
    margin: 10px 0;
    border: 2px solid var(--color-borders);
}

.stability-fill {
    height: 100%;
    transition: width 0.5s ease, background-color 0.5s ease;
    background: linear-gradient(90deg, #4caf50 0%, #8bc34a 100%);
}

.stability-fill.danger {
    background: linear-gradient(90deg, #ff9800 0%, #ffb74d 100%);
}

.stability-fill.critical {
    background: linear-gradient(90deg, #f44336 0%, #e57373 100%);
    animation: pulse 1.5s ease-in-out infinite;
}

/* Apply Card Button Enhancement */
button[onclick*="applyCurrentCard"] {
    background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%) !important;
    border-color: #4CAF50 !important;
    font-weight: bold;
}

button[onclick*="applyCurrentCard"]:hover {
    background: linear-gradient(135deg, #66BB6A 0%, #4CAF50 100%) !important;
}


        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr !important;
                gap: 20px;
            }

            h1 {
                font-size: 2em !important;
            }

            h2 {
                font-size: 1.5em !important;
            }

            .die {
                width: 60px !important;
                height: 60px !important;
                font-size: 30px !important;
            }

            .panel {
                padding: 15px !important;
            }

            .section {
                padding: 12px !important;
            }
        }

        /* Accessibility Improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Focus styles for keyboard navigation */
        button:focus,
        textarea:focus {
            outline: 3px solid var(--color-accent_primary);
            outline-offset: 2px;
        }

        /* Loading state */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Print styles for journal */
        @media print {
            .controls-panel {
                display: none !important;
            }

            .panel {
                box-shadow: none !important;
                border: 1px solid #000 !important;
            }

            button {
                display: none !important;
            }

            textarea {
                border: none !important;
                background: white !important;
                color: black !important;
            }

            body {
                background: white !important;
                color: black !important;
            }
        }

        /* Better history display */
        .history-item {
            padding: 6px 10px;
            margin: 4px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            border-left: 3px solid var(--color-accent_primary);
            font-size: 0.9em;
        }

        /* Stability color coding */
        .stability-safe {
            color: #4caf50;
        }

        .stability-danger {
            color: #ff9800;
        }

        .stability-critical {
            color: #f44336;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Game end styling */
        .game-end {
            text-align: center;
            padding: 20px;
        }

        .game-end h2 {
            margin-bottom: 15px;
        }

        /* Subtitle styling */
        .subtitle {
            text-align: center;
            font-style: italic;
            color: var(--color-text_secondary);
            margin-bottom: 20px;
        }

        /* Better button hover effects */
        button:active {
            transform: translateY(0);
        }

        /* Improved modal accessibility */
        .modal-overlay:focus {
            outline: none;
        }

        .modal-content:focus {
            outline: 2px solid var(--color-accent_primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Panel: Game Controls -->
        <div class="panel controls-panel">
            <h1>The Cave</h1>
            
            <p class="subtitle">An Archaeological Mystery</p>
            
            
            <!-- Dice Section -->
            
            <div class="section" role="region" aria-label="Dice Rolling">
                <h3>Roll Dice</h3>
                <div class="dice-container">
                    <div class="die" id="die1" role="img" aria-label="Die 1">
                        <span>-</span>
                    </div>
                    <div class="die" id="die2" role="img" aria-label="Die 2">
                        <span>-</span>
                    </div>
                </div>
                <button onclick="rollDice()" aria-label="Roll two six-sided dice">Roll 2d6</button>
                <div id="diceResult" style="margin-top: 10px; font-weight: bold;" role="status" aria-live="polite">Total: -</div>
            </div>
            
            
            <!-- Card Drawing Section -->
            
            <div class="section" role="region" aria-label="Card Drawing">
                <h3>Draw Card</h3>
                <button onclick="drawCard()" aria-label="Draw a card from the deck">Draw Card</button>
                <div style="margin-top: 10px;">
                    <strong>Cards Remaining: <span id="deckCount" aria-live="polite">52</span></strong>
                </div>
                <div class="card-display" id="cardResult" role="status" aria-live="polite">
                    No card drawn yet
                </div>

                
                <h4 style="margin-top: 20px;">Recent Cards</h4>
                <div id="cardHistory" style="font-size: 0.9em;" aria-label="Recently drawn cards"></div>
                
            </div>
            
            
            <!-- Stability Section -->
            
            <div class="section" role="region" aria-label="Stability Tracker">
                <h3><span id="stabilityName">Academic Credibility</span></h3>
                <div style="font-size: 2em; font-weight: bold; margin: 10px 0;">
                    <span id="stabilityValue" class="stability-safe" aria-live="polite" role="status">100</span>
                </div>
                <div class="stability-bar" role="progressbar" aria-label="Stability level" aria-valuemin="0" aria-valuemax="100">
                    <div id="stabilityBar" class="stability-fill" style="width: 100%;"></div>
                </div>
                <button onclick="pullBlock()" id="pullButton" aria-label="Pull a block from the stability tower">Pull Block</button>
            </div>
            

            <!-- Tokens Section -->
            
            <div class="section" role="region" aria-label="Token Counter">
                <h3><span id="tokenName">Evidence Fragments</span></h3>
                <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin: 10px 0;">
                    <button onclick="adjustTokens(-1)" aria-label="Decrease tokens by 1">-</button>
                    <span style="font-size: 2em; font-weight: bold;" id="tokenValue" aria-live="polite" role="status">10</span>
                    <button onclick="adjustTokens(1)" aria-label="Increase tokens by 1">+</button>
                </div>
            </div>
            

            <div class="section">
                <button onclick="newGame()" style="width: 100%; background: #c0392b;" aria-label="Start a new game (erases current progress)">New Game</button>
            </div>
        </div>
        
        <!-- Right Panel: Story and Journal -->
        <div class="panel journal-panel" role="region" aria-label="Journal">
            <!-- Story/Instructions -->
            
            <div class="section">
                <button onclick="document.getElementById('storyModal').classList.add('active')" aria-label="Read game instructions and story">
                    📖 Read Instructions
                </button>
            </div>
            

            <!-- Journal -->
            <h2 id="journal-heading">Journal</h2>
            <p style="font-style: italic; margin-bottom: 10px;">Record your archaeological discoveries here...</p>
            <textarea
                id="journal"
                placeholder="Record your archaeological discoveries here..."
                aria-labelledby="journal-heading"
                aria-describedby="journal-description"></textarea>
            <span id="journal-description" class="sr-only">Your journal entries are automatically saved to your browser's local storage</span>

            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button onclick="downloadJournal()" aria-label="Download journal as text file">💾 Save to File</button>
            </div>

            <div style="margin-top: 20px; font-size: 0.9em; font-style: italic; color: var(--color-text_secondary);">
                <p>Game by Shawn Graham</p>
                
                <p>Version 1.0.0</p>
                
            </div>
        </div>
    </div>
    
    <!-- Story Modal -->
    
    <div id="storyModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="story-title">
        <div class="modal-content" tabindex="-1">
            <button
                class="modal-close"
                onclick="document.getElementById('storyModal').classList.remove('active')"
                aria-label="Close instructions dialog">&times;</button>
            <div id="story-title">
                <h1>The Cave: An Archaeological Mystery</h1>
<h2>Your Character</h2>
<p><strong>Name:</strong> Dr. Elisabeth Blackwood<br />
<strong>Occupation:</strong> Independent Archaeologist<br />
<strong>Location:</strong> A remote cave system in the English countryside<br />
<strong>Date:</strong> June 15th, 1924</p>
<p>You are Dr. Elisabeth Blackwood, one of the few women working in the male-dominated field of archaeology. After years of being dismissed by the academic establishment, you've staked everything on this excavation.</p>
<p>A local farmer told you about a cave on his land—a cave with strange markings and rumors of ancient habitation. The Royal Archaeological Society laughed at your proposal. Your former mentor politely declined to help. Your family thinks you've lost your mind.</p>
<p>But you know. You've always known. This cave holds secrets that could revolutionize everything we understand about prehistoric Britain.</p>
<p>You've set up camp near the entrance. Your equipment is modest: trowels, brushes, notebooks, a camera, and determination. The cave waits, dark and silent, holding its mysteries close.</p>
<p>Your academic reputation is on the line. Your evidence is limited. Your mental state is fragile. But this is your chance—perhaps your only chance—to prove yourself.</p>
<h2>How to Play</h2>
<h3>Setup</h3>
<ul>
<li>Begin with <strong>10 Evidence Fragments</strong> (representing the archaeological evidence you collect)</li>
<li>Your <strong>Academic Credibility</strong> starts at 100 (representing your reputation and mental state)</li>
<li>You have a standard deck of 52 playing cards</li>
<li>Keep a journal to record your discoveries</li>
</ul>
<h3>The Core Loop</h3>
<p>Each session of excavation follows this pattern:</p>
<ol>
<li><strong>Roll 2d6</strong> to determine your focus for this session</li>
<li><strong>Draw cards</strong> equal to the dice total (2-12 cards)</li>
<li><strong>Respond to each card's prompt</strong> in your journal</li>
<li><strong>Follow any special instructions</strong> on the cards</li>
<li><strong>Continue</strong> until the deck is empty or the game ends</li>
</ol>
<h3>The Cards</h3>
<p>The deck represents the unpredictable nature of archaeological work. Each card draws you deeper into the cave's mystery:</p>
<ul>
<li><strong>♠️ Spades - The Cave's Secrets:</strong> Discoveries, mysteries, and revelations within the cave</li>
<li><strong>♥️ Hearts - Academic Relations:</strong> Your peers, rivals, supporters, and the establishment</li>
<li><strong>♦️ Diamonds - Resources and Methodology:</strong> Tools, techniques, and practical challenges</li>
<li><strong>♣️ Clubs - Mental Strain:</strong> Psychological pressure, exhaustion, and doubt</li>
</ul>
<h3>Evidence Fragments</h3>
<p>Your <strong>Evidence Fragments</strong> represent the quality and quantity of archaeological evidence you've collected. This is your currency of credibility.</p>
<ul>
<li>Start with <strong>10 Evidence Fragments</strong></li>
<li>Cards can add or remove Evidence</li>
<li>If you reach <strong>0 Evidence</strong>, you've destroyed or lost all the proof of your discovery</li>
<li>You can go negative (representing fabricated or questionable evidence)</li>
</ul>
<h3>Academic Credibility (The Tower)</h3>
<p>Your <strong>Academic Credibility</strong> represents both your reputation and your mental state. Like a Jenga tower, it starts stable but becomes increasingly precarious.</p>
<ul>
<li>Start with <strong>100 Credibility</strong></li>
<li>Some cards require you to <strong>Pull Blocks</strong> (reduce your Credibility)</li>
<li>When you pull blocks, the game simulates removing pieces from a tower</li>
<li><strong>The risk escalates:</strong> Lower Credibility means higher chance of losing more points</li>
<li>If Credibility reaches <strong>0</strong>, your reputation collapses and the game ends</li>
</ul>
<p>The escalating risk mechanics:<br />
- <strong>Above 50:</strong> Low risk (stable)<br />
- <strong>20-50:</strong> Moderate risk (dangerous)<br />
- <strong>Below 20:</strong> High risk (critical)</p>
<h3>Winning</h3>
<p>You <strong>win</strong> if you complete the excavation successfully:</p>
<ul>
<li>Draw all 52 cards from the deck</li>
<li>Maintain positive Evidence Fragments</li>
<li>Keep your Academic Credibility above 0</li>
</ul>
<p>Your triumph is complete: your work survives peer review and publication. You revolutionize archaeology! Dr. Elisabeth Blackwood's name will echo through history.</p>
<h3>Losing</h3>
<p>You <strong>lose</strong> if either:</p>
<ol>
<li>
<p><strong>Academic Credibility reaches 0:</strong> Your reputation collapses. You might retreat in shame or become an unpaid assistant to a rival.</p>
</li>
<li>
<p><strong>Evidence Fragments reach 0:</strong> You've destroyed all archaeological evidence. The cave has lost its mystery. You become a schoolmistress in a local village, your dreams of archaeology behind you.</p>
</li>
</ol>
<h2>Game Mechanics Detail</h2>
<h3>Turn Structure</h3>
<ol>
<li><strong>Begin your excavation session</strong> by rolling 2d6</li>
<li>The total determines how many cards to draw this turn (2-12)</li>
<li><strong>Draw the indicated cards one at a time</strong></li>
<li>Read each card's prompt and follow its instructions</li>
<li><strong>Write your response</strong> in your journal—this is where the story lives</li>
<li>Apply any mechanical effects (Evidence changes, block pulls)</li>
<li>When all cards for the turn are resolved, you can:<br />
   - Roll again to continue excavating<br />
   - Take a break to organize your notes<br />
   - End the session</li>
</ol>
<h3>Special Cards</h3>
<h4>Ace of Hearts: "Letter from the Society"</h4>
<p>This card requires a special roll:<br />
- Roll 1d6<br />
- On a <strong>6:</strong> Your defense is persuasive. Gain 1 Evidence<br />
- On <strong>1-5:</strong> Your defense falls flat. Lose 1 Evidence</p>
<p>This represents the Society's judgment of your work.</p>
<h3>Journaling</h3>
<p>Your journal is the heart of the game. This is where you:</p>
<ul>
<li><strong>Describe discoveries</strong> in vivid detail</li>
<li><strong>Express your character's emotions</strong> and thoughts</li>
<li><strong>Record the academic politics</strong> and personal struggles</li>
<li><strong>Build the narrative</strong> of your excavation</li>
<li><strong>Document evidence</strong> as a Victorian scholar would</li>
</ul>
<p>There's no wrong way to journal, but consider:<br />
- Writing in first person as Dr. Blackwood<br />
- Dating your entries<br />
- Using period-appropriate language and perspective<br />
- Describing not just what you find, but how it feels<br />
- Grappling with the isolation, pressure, and wonder</p>
<h3>Saving Your Work</h3>
<p>The game automatically saves your progress to your browser. You can also:<br />
- <strong>Save to File</strong> to download your journal as a text file<br />
- <strong>Load File</strong> to restore a previous journal<br />
- <strong>Start New Game</strong> to begin fresh (warning: this erases everything)</p>
<h2>Tips for Play</h2>
<h3>For Your First Game</h3>
<ul>
<li>Don't rush. Read each card carefully.</li>
<li>Really imagine yourself in the cave—the darkness, the damp, the weight of earth above.</li>
<li>Let your journal entries be messy and emotional. You're under pressure!</li>
<li>Don't worry about "winning"—the story you create is the real victory.</li>
</ul>
<h3>For Deeper Immersion</h3>
<ul>
<li>Play with atmospheric music (cave sounds, Victorian-era music, or silence)</li>
<li>Dim the lights</li>
<li>Actually write by hand in a physical journal</li>
<li>Research real Victorian archaeology to inspire your descriptions</li>
<li>Set a timer and treat it like a real excavation session (2-3 hours)</li>
</ul>
<h3>Managing Risk</h3>
<ul>
<li><strong>Early game:</strong> Be bold. You have plenty of Credibility to spare.</li>
<li><strong>Mid game:</strong> Start being cautious. Consider the risk before pulling blocks.</li>
<li><strong>Late game:</strong> Every block pull is terrifying. Choose wisely.</li>
</ul>
<p>Remember: The game is designed to create tension. The escalating risk means the endgame should feel genuinely dangerous.</p>
<h3>Interpreting Cards</h3>
<p>The cards provide prompts, but you decide how to interpret them:<br />
- Maybe that "golden idol" is actually an elaborate hoax<br />
- Perhaps "academic jealousy" motivates you rather than demoralizes you<br />
- The "burial site" could rewrite everything we know about the period</p>
<p>Let the cards guide you, but the story is yours.</p>
<h2>Historical Context</h2>
<h3>Archaeology in 1924</h3>
<p>The 1920s were a transformative time for archaeology:<br />
- Tutankhamun's tomb was discovered in 1922<br />
- New scientific methods were emerging<br />
- Women in archaeology faced immense barriers<br />
- The field was dominated by wealthy amateurs and established academics</p>
<h3>Dr. Elisabeth Blackwood</h3>
<p>You are pushing against an establishment that doesn't want you there. You're one of the first generation of professionally trained female archaeologists. You've had to work twice as hard for half the recognition.</p>
<p>This cave is your chance to prove yourself—but also to make a genuine contribution to human knowledge. The cave doesn't care about your gender. The ancient people who lived there left their mark for someone to find. That someone is you.</p>
<h3>The Setting</h3>
<p>The cave is fictional, but inspired by real archaeological sites:<br />
- Creswell Crags in Derbyshire<br />
- Chauvet Cave in France<br />
- Various British cave systems with evidence of human habitation</p>
<p>The Victorian countryside, the academic politics, the isolation—all rooted in historical reality.</p>
<h2>About This Game</h2>
<p><strong>The Cave</strong> is a solo journaling RPG using the "Wretched &amp; Alone" game system created by Chris Bissette. It explores themes of:</p>
<ul>
<li><strong>Ambition and obsession</strong></li>
<li><strong>Gender barriers in academia</strong></li>
<li><strong>The weight of history</strong></li>
<li><strong>Isolation and discovery</strong></li>
<li><strong>The price of knowledge</strong></li>
</ul>
<p>The game asks: What would you sacrifice for recognition? For truth? For the chance to touch the past?</p>
<hr />
<h2>Ready to Begin?</h2>
<p>The cave waits. It has waited for thousands of years. It can wait a little longer.</p>
<p>But you cannot. Your funding is limited. Your critics are watching. Your reputation hangs in the balance.</p>
<p>Light your lamp. Pick up your trowel. Open your journal.</p>
<p><em>The excavation begins now.</em></p>
<hr />
<p><em>Dr. Blackwood, the cave is calling. Will you answer?</em></p>
            </div>
        </div>
    </div>
    
    
    <script>
        
// Game Configuration
const GAME_CONFIG = {
  "game": {
    "title": "The Cave",
    "subtitle": "An Archaeological Mystery",
    "author": "Shawn Graham",
    "version": "1.0.0",
    "description": "You are Dr. Elisabeth Blackwood, excavating a mysterious cave in 1924. Can you survive the discovery?"
  },
  "mechanics": {
    "systems": [
      "dice",
      "cards",
      "stability",
      "tokens"
    ],
    "stability": {
      "initial": 100,
      "name": "Academic Credibility",
      "description": "Your reputation and mental state",
      "narrative_flavor": "academic",
      "thresholds": {
        "critical": 20,
        "danger": 50,
        "safe": 51
      },
      "risk_scaling": true,
      "failure_thresholds": {
        "critical": 3,
        "danger": 2,
        "safe": 1
      },
      "messages": {
        "safe": [
          "Your methodology remains sound and systematic.",
          "The work proceeds with scholarly precision.",
          "You maintain your academic composure."
        ],
        "danger": [
          "Self-doubt creeps into your thinking.",
          "The pressure from your peers weighs heavily.",
          "Your confidence wavers slightly."
        ],
        "critical": [
          "Your reputation hangs by a thread.",
          "Desperation clouds your judgment.",
          "The academic world watches, waiting for you to fail."
        ]
      },
      "collapse_message": "\ud83d\udc94 Academic Credibility Destroyed - Your reputation is ruined."
    },
    "tokens": {
      "initial": 10,
      "name": "Evidence Fragments",
      "description": "Archaeological evidence you've collected",
      "count_up": false,
      "display_type": "numeric",
      "allow_negative": true,
      "controls": {
        "show_manual_adjust": true,
        "increment": 1
      }
    },
    "deck": {
      "type": "standard_52",
      "reshuffle": true,
      "track_history": true,
      "show_remaining_count": true
    },
    "dice": {
      "main": {
        "name": "Turn Dice",
        "count": 2,
        "sides": 6,
        "function": "determine_cards",
        "animation": true
      }
    }
  },
  "conditions": {
    "win": [
      {
        "type": "deck_empty",
        "additional_checks": [
          "tokens_positive",
          "stability_above_zero"
        ],
        "message": "\ud83c\udfc6 TRIUMPHANT SUCCESS!\nYour work survives peer review and publication. You revolutionize archaeology!\n\nWrite the opening for your public lecture at The Society's annual meeting.\n\nDr. Elisabeth Blackwood's name will echo through history.\n"
      }
    ],
    "lose": [
      {
        "type": "stability_zero",
        "endings": [
          {
            "title": "Retreat in Shame",
            "text": "Your academic reputation is ruined. You retreat to a cottage in the far country, spending your days cataloguing moss."
          },
          {
            "title": "Unpaid Assistant",
            "text": "Sir Reginald Watterly smiles with satisfaction as he deposits your paper in the wastebasket. You become his unpaid assistant."
          }
        ],
        "message": "Record your final thoughts in your journal..."
      },
      {
        "type": "tokens_zero",
        "message": "\ud83d\udc94 All Evidence Destroyed\nYou have managed to destroy all archaeological evidence. The cave has lost its mystery.\nYou develop a reputation for carelessness and take a schoolmistress position in the village.\n"
      }
    ]
  },
  "ui": {
    "layout": "two_column",
    "panels": {
      "left_width": "400px",
      "show_instructions": true,
      "show_help_button": true,
      "show_card_reference": true
    },
    "journal": {
      "placeholder": "Record your archaeological discoveries here...",
      "autosave": true,
      "save_indicator": true,
      "download_button": true,
      "load_button": true
    },
    "controls": {
      "new_game_confirmation": true,
      "show_card_history": true,
      "history_clear_button": true
    }
  },
  "special": {
    "queen_tracker": {
      "enabled": false
    },
    "ace_of_hearts": {
      "enabled": false
    },
    "turn_sequence": {
      "roll_determines_cards": true,
      "formula": "sum",
      "min_cards": 2,
      "max_cards": 12
    }
  },
  "flow": {
    "starting_prompt": "Welcome, Dr. Blackwood.\n\nRoll the dice to determine how many cards to draw this turn.\nEach card represents a discovery, challenge, or moment in your excavation.\n\nDraw cards and respond to their prompts in your journal.\n",
    "end_turn_button": false,
    "auto_advance": false
  },
  "locale": {
    "language": "en",
    "date_format": "MMMM DD, YYYY",
    "time_format": "12h"
  },
  "build": {
    "minify": true,
    "inline_assets": true,
    "generate_print_version": false
  }
};
const CARD_DATA = {
  "spades": {
    "A": {
      "title": "The First Chamber",
      "description": "You push through the narrow entrance and emerge into a vast underground chamber. \nThe walls glitter with moisture and ancient mineral deposits. In the flickering light \nof your torch, you can make out marks on the walls\u2014deliberate patterns, perhaps?\n\n*What do you hope to find here?*\n",
      "tokens": 2,
      "blocks": 0
    },
    "K": {
      "title": "The Inscription",
      "description": "On the far wall, you discover a series of carved symbols\u2014a written language! \nYour heart races. This could revolutionize everything we know about this region's history.\nBut the symbols are unlike anything in the literature...\n\n*What do the symbols seem to depict?*\n",
      "tokens": 3,
      "blocks": 0
    },
    "Q": {
      "title": "The Golden Idol",
      "description": "Half-buried in sediment, you uncover a golden figurine\u2014exquisitely crafted, \ndepicting a figure with outstretched arms. It's beautiful, valuable, and unlike \nanything found in this region before. But removing it might destabilize the cave structure.\n\n*Do you take it? What does it represent?*\n",
      "tokens": 3,
      "blocks": 2
    },
    "J": {
      "title": "Ancient Tools",
      "description": "You find a cache of stone tools\u2014scrapers, blades, and points\u2014still sharp after \nmillennia. They're arranged with care, perhaps a craftsperson's kit. Evidence of \nsophisticated technology!\n\n*What does this tell you about the people who lived here?*\n",
      "tokens": 2,
      "blocks": 0
    },
    "10": {
      "title": "The Fossil Wall",
      "description": "An entire wall is embedded with fossils\u2014shells, ancient fish, strange plants. \nThis area was underwater millions of years ago. The geological evidence is pristine.\n\n*What does this reveal about the site's history?*\n",
      "tokens": 2,
      "blocks": 0
    },
    "9": {
      "title": "Wall Paintings",
      "description": "You discover ochre paintings on the cave wall\u2014animals, hand prints, abstract \npatterns. Art! Human expression from thousands of years ago. Each image tells a story.\n\n*What scenes are depicted? What do they mean?*\n",
      "tokens": 3,
      "blocks": 0
    },
    "8": {
      "title": "The Burial Site",
      "description": "You uncover human remains, carefully arranged with grave goods\u2014beads, tools, \nand a peculiar clay vessel. A burial chamber. Someone was laid to rest here with honor.\n\n*Who was this person? What do the grave goods suggest?*\n",
      "tokens": 2,
      "blocks": 1
    },
    "7": {
      "title": "Strange Acoustics",
      "description": "You notice the cave has unusual acoustic properties. Certain spots amplify sound \nin eerie ways. Was this intentional? A ceremonial space, perhaps?\n\n*Test the acoustics. What do you hear?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "6": {
      "title": "Animal Bones",
      "description": "A scatter of animal bones\u2014deer, rabbit, birds. Some show cut marks from butchering. \nEvidence of meals, of daily life. The mundane details that make history human.\n\n*What can you learn from these remains?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "5": {
      "title": "The Side Passage",
      "description": "You discover a narrow side passage you hadn't noticed before. It slopes downward \ninto darkness. Do you follow it, or continue in the main chamber?\n\n*What do you do? What might lie deeper?*\n",
      "tokens": 1,
      "blocks": 1
    },
    "4": {
      "title": "Pottery Shards",
      "description": "You find fragments of pottery\u2014decorated with geometric patterns. The pieces are \ntoo broken to reconstruct fully, but the craftsmanship is evident.\n\n*What patterns do you see? What might the vessels have contained?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "3": {
      "title": "The Echo Chamber",
      "description": "You find a small alcove that creates perfect echoes. Standing here, you imagine \nancient voices, songs, stories told in this very spot.\n\n*What do you imagine was said here?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "2": {
      "title": "Charcoal Marks",
      "description": "Black marks on the ceiling\u2014charcoal from ancient fires. Evidence of habitation, \nof warmth and cooking. You can date these marks!\n\n*What do the fire patterns tell you?*\n",
      "tokens": 1,
      "blocks": 0
    }
  },
  "hearts": {
    "A": {
      "title": "Letter from the Society",
      "description": "A telegram arrives from London. The Royal Archaeological Society questions your \nmethods and demands you return immediately for review. Roll a die\u2014on a 6, your \ndefense is persuasive enough to buy time.\n\n*How do you respond to their challenge?*\n",
      "tokens": 0,
      "blocks": 0,
      "special": "roll_for_token_adjustment"
    },
    "K": {
      "title": "Sir Reginald's Mockery",
      "description": "You receive word that Sir Reginald Watterly has published an article dismissing \nyour work as \"amateur speculation by a woman playing at archaeology.\" The old guard \ncloses ranks against you.\n\n*How does this affect your resolve?*\n",
      "tokens": -1,
      "blocks": 1
    },
    "Q": {
      "title": "Unexpected Ally",
      "description": "Professor Morrison from Cambridge sends an encouraging letter. She believes in \nyour work and promises to defend your findings at the next conference. A rare \nsupporter in a hostile field.\n\n*Write your grateful reply.*\n",
      "tokens": 1,
      "blocks": 0
    },
    "J": {
      "title": "The Journalist",
      "description": "A journalist from The Times wants to write about your excavation. This could \nbring attention\u2014and funding\u2014but also scrutiny. Do you grant an interview?\n\n*What do you tell them?*\n",
      "tokens": 0,
      "blocks": 1
    },
    "10": {
      "title": "Funding Crisis",
      "description": "Your benefactor writes that they're withdrawing support unless you produce results \nimmediately. The financial pressure mounts. You need discoveries, now.\n\n*How do you cope with this pressure?*\n",
      "tokens": -2,
      "blocks": 1
    },
    "9": {
      "title": "Academic Jealousy",
      "description": "You learn that Dr. Thornton is planning his own expedition to a nearby site, \nhoping to overshadow your work. The race is on.\n\n*How does competition affect your work?*\n",
      "tokens": 0,
      "blocks": 1
    },
    "8": {
      "title": "Supportive Letter",
      "description": "Your former mentor writes with encouragement and advice. Their wisdom steadies you. \nRemember why you became an archaeologist.\n\n*What wisdom do they share?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "7": {
      "title": "Museum Interest",
      "description": "The British Museum expresses interest in your finds. They want first right to \nany significant artifacts. This is validation\u2014but also pressure.\n\n*How do you feel about their interest?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "6": {
      "title": "Peer Review Fears",
      "description": "You worry about how your peers will receive your findings. What if you're wrong? \nWhat if they ridicule you? The doubt gnaws at you.\n\n*Confront these fears in your journal.*\n",
      "tokens": 0,
      "blocks": 1
    },
    "5": {
      "title": "Conference Invitation",
      "description": "You're invited to present preliminary findings at a regional conference. \nAn opportunity\u2014or a trap? They'll scrutinize every claim.\n\n*Do you accept? What will you present?*\n",
      "tokens": 0,
      "blocks": 0
    },
    "4": {
      "title": "Student's Letter",
      "description": "A student writes asking to join your excavation. Fresh enthusiasm and an extra \npair of hands\u2014but also responsibility and teaching duties.\n\n*Do you accept the student?*\n",
      "tokens": 0,
      "blocks": 0
    },
    "3": {
      "title": "Praise and Pressure",
      "description": "A colleague praises your ambition but warns that you're risking everything on \nthis one site. What if it yields nothing spectacular?\n\n*How do you respond to this warning?*\n",
      "tokens": 0,
      "blocks": 1
    },
    "2": {
      "title": "Family Concern",
      "description": "A letter from home. Your family worries about you, alone in this remote place, \npursuing what they see as a quixotic dream. They want you to come home.\n\n*What do you tell them?*\n",
      "tokens": 0,
      "blocks": 0
    }
  },
  "diamonds": {
    "A": {
      "title": "Perfect Documentation",
      "description": "You achieve perfect documentation of a key find\u2014photographs, sketches, measurements, \ncontext. This is the gold standard of archaeological work. Your methodology is impeccable.\n\n*What have you documented so perfectly?*\n",
      "tokens": 3,
      "blocks": 0
    },
    "K": {
      "title": "Tool Malfunction",
      "description": "Your best trowel breaks. A lamp fails. Equipment wears out in the damp cave environment. \nYou'll need to improvise or work more slowly.\n\n*How do you adapt?*\n",
      "tokens": -1,
      "blocks": 1
    },
    "Q": {
      "title": "Revolutionary Technique",
      "description": "You develop a new excavation technique perfectly suited to the cave's conditions. \nThis method could become standard practice. A methodological breakthrough!\n\n*Describe your innovation.*\n",
      "tokens": 2,
      "blocks": 0
    },
    "J": {
      "title": "Supply Shipment",
      "description": "Fresh supplies arrive from town\u2014new notebooks, lamp oil, preservation materials. \nYou're well-equipped to continue the work.\n\n*What supplies are most welcome?*\n",
      "tokens": 2,
      "blocks": 0
    },
    "10": {
      "title": "Weather Delay",
      "description": "Heavy rain makes the cave entrance treacherous. You must halt work for days. \nFrustrating delays, but safety first. Time to catch up on notes.\n\n*How do you use this forced break?*\n",
      "tokens": 0,
      "blocks": 0
    },
    "9": {
      "title": "Careful Excavation",
      "description": "You work with painstaking care, brushing away sediment grain by grain. Slow, \nmeticulous, professional. This is how it should be done.\n\n*What emerges from your careful work?*\n",
      "tokens": 2,
      "blocks": 0
    },
    "8": {
      "title": "Contamination Risk",
      "description": "You realize you've been careless\u2014modern materials have mixed with ancient deposits. \nThis could compromise dating. A methodological error that haunts you.\n\n*How do you address this mistake?*\n",
      "tokens": -2,
      "blocks": 1
    },
    "7": {
      "title": "Photography Session",
      "description": "Perfect lighting today. You photograph everything from multiple angles, creating \na comprehensive visual record. These images will be invaluable.\n\n*What do the photographs reveal?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "6": {
      "title": "Note-Taking Marathon",
      "description": "You spend the day organizing field notes, cross-referencing observations, building \na coherent narrative from scattered details. The intellectual work of archaeology.\n\n*What patterns emerge from your notes?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "5": {
      "title": "Equipment Shortage",
      "description": "You're running low on essential supplies\u2014paper for notes, lamp oil, preservation \nchemicals. You'll need to ration carefully.\n\n*What do you prioritize?*\n",
      "tokens": -1,
      "blocks": 0
    },
    "4": {
      "title": "Sampling Success",
      "description": "You collect perfect samples for dating\u2014charcoal, bone, sediment\u2014all properly \nlabeled and preserved. Laboratory analysis will be conclusive.\n\n*What do you hope the lab results will show?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "3": {
      "title": "Mapping Progress",
      "description": "Your map of the cave grows more detailed. Every passage, every chamber, carefully \nmeasured and drawn. A cartographic achievement.\n\n*What does the map reveal about the cave's structure?*\n",
      "tokens": 1,
      "blocks": 0
    },
    "2": {
      "title": "Preservation Challenge",
      "description": "A delicate artifact begins to deteriorate in the air. You must stabilize it \nimmediately with the materials at hand. A race against decay.\n\n*How do you save it?*\n",
      "tokens": 0,
      "blocks": 1
    }
  },
  "clubs": {
    "A": {
      "title": "Existential Crisis",
      "description": "In the darkness, you question everything. Why are you here? What does any of \nthis matter? The weight of time presses down. Who will remember these ancient \npeople\u2014or you?\n\n*Confront these dark thoughts.*\n",
      "tokens": 0,
      "blocks": 2
    },
    "K": {
      "title": "Physical Exhaustion",
      "description": "Your body aches. Days of crouching, crawling, digging have taken their toll. \nEvery muscle screams. You're not as young as you once were.\n\n*How do you push through?*\n",
      "tokens": 0,
      "blocks": 2
    },
    "Q": {
      "title": "Nightmare",
      "description": "You dream of the cave collapsing, of being buried alive, of failure and mockery. \nYou wake in a cold sweat. The dreams are becoming more frequent.\n\n*What haunts your dreams?*\n",
      "tokens": 0,
      "blocks": 1
    },
    "J": {
      "title": "Isolation",
      "description": "The loneliness weighs on you. Days without real conversation. Just you and the \nsilent stones. Sometimes you talk to yourself just to hear a human voice.\n\n*What do you miss most about civilization?*\n",
      "tokens": 0,
      "blocks": 1
    },
    "10": {
      "title": "Claustrophobia",
      "description": "The walls seem closer today. The ceiling lower. Your breath quickens. The weight \nof rock above you is suddenly, terribly real. You need air.\n\n*How do you calm yourself?*\n",
      "tokens": 0,
      "blocks": 2
    },
    "9": {
      "title": "Doubt and Despair",
      "description": "What if this cave yields nothing significant? What if years of work produce \nnothing but mundane artifacts? What if you've wasted everything?\n\n*Fight back against despair.*\n",
      "tokens": -1,
      "blocks": 1
    },
    "8": {
      "title": "The Darkness",
      "description": "Your lamp flickers. For a moment, absolute darkness. The terror of being lost \nforever in the earth. The lamp steadies, but the fear remains.\n\n*Describe that moment of darkness.*\n",
      "tokens": 0,
      "blocks": 1
    },
    "7": {
      "title": "Fever",
      "description": "You feel unwell\u2014perhaps the damp, perhaps bad food, perhaps exhaustion. You \nwork through it, but you're not at your best. Mistakes creep in.\n\n*What mistakes do you make?*\n",
      "tokens": -1,
      "blocks": 1
    },
    "6": {
      "title": "Paranoia",
      "description": "You sense you're being watched. Ridiculous, of course. You're alone. But the \nfeeling persists. Shadows move at the edge of your vision.\n\n*What's real and what's imagination?*\n",
      "tokens": 0,
      "blocks": 1
    },
    "5": {
      "title": "Memory Lapse",
      "description": "You can't remember if you documented a crucial find. Did you photograph it? \nMeasure it? Take notes? The fatigue is affecting your mind.\n\n*Retrace your steps.*\n",
      "tokens": 0,
      "blocks": 1
    },
    "4": {
      "title": "Accident",
      "description": "You slip and fall, dropping your equipment. A scrape, a bruise, a close call. \nThe cave is dangerous. You could get seriously hurt here.\n\n*How does this affect your caution?*\n",
      "tokens": 0,
      "blocks": 1
    },
    "3": {
      "title": "Homesickness",
      "description": "You long for familiar places\u2014a comfortable chair, a proper meal, friends who \nunderstand. The primitive conditions wear on you.\n\n*What comforts do you miss?*\n",
      "tokens": 0,
      "blocks": 1
    },
    "2": {
      "title": "Lost Time",
      "description": "Hours pass and you realize you've been staring at the wall, mind blank. Fatigue \nor something worse? You're losing track of time.\n\n*What breaks your trance?*\n",
      "tokens": 0,
      "blocks": 1
    }
  },
  "special_cards": {
    "ace_of_hearts": {
      "type": "roll_check",
      "die": "1d6",
      "success_value": 6,
      "on_success": {
        "tokens": 1,
        "message": "Rolled a 6! Your defense is persuasive. Gain 1 Evidence."
      },
      "on_failure": {
        "tokens": -1,
        "message": "Your defense falls flat. Lose 1 Evidence."
      }
    }
  }
};

// Game State
let gameState = {
    tokens: 10,
    stability: 100,
    deck: [],
    drawnCards: [],
    cardHistory: [],
    pendingCard: null,
    gameEnded: false
};

// Initialize deck
function initializeDeck() {
    const suits = ['spades', 'hearts', 'diamonds', 'clubs'];
    const values = ['A', 'K', 'Q', 'J', '10', '9', '8', '7', '6', '5', '4', '3', '2'];
    gameState.deck = [];
    
    for (let suit of suits) {
        for (let value of values) {
            gameState.deck.push({ suit, value });
        }
    }
    
    shuffleDeck();
    updateDeckDisplay();
}

function shuffleDeck() {
    for (let i = gameState.deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [gameState.deck[i], gameState.deck[j]] = [gameState.deck[j], gameState.deck[i]];
    }
}

// Dice rolling
function rollDice() {
    const die1 = document.getElementById('die1');
    const die2 = document.getElementById('die2');
    
    die1.classList.add('rolling');
    die2.classList.add('rolling');
    
    setTimeout(() => {
        const result1 = Math.floor(Math.random() * 6) + 1;
        const result2 = Math.floor(Math.random() * 6) + 1;
        const total = result1 + result2;
        
        die1.firstChild.textContent = result1;
        die2.firstChild.textContent = result2;
        
        document.getElementById('diceResult').textContent = `Total: ${total}`;
        
        die1.classList.remove('rolling');
        die2.classList.remove('rolling');
    }, 600);
}

// Card drawing
function drawCard() {
    if (gameState.deck.length === 0) {
        if (GAME_CONFIG.mechanics.deck.reshuffle) {
            alert('Deck empty! Reshuffling...');
            initializeDeck();
        } else {
            alert('Deck is empty!');
            return;
        }
    }

    // Check if there's already a pending card
    if (gameState.pendingCard) {
        alert('Please apply the current card effects before drawing another card.');
        return;
    }

    const card = gameState.deck.pop();
    const cardData = CARD_DATA[card.suit][card.value];

    // Store as pending card
    gameState.pendingCard = { card, cardData };

    // Display card for examination
    displayCard(card, cardData);

    // Update displays
    updateDeckDisplay();
    saveGameState();
}

function applyCurrentCard() {
    if (!gameState.pendingCard) {
        alert('No card to apply.');
        return;
    }

    const { card, cardData } = gameState.pendingCard;

    // Add to history
    gameState.cardHistory.unshift({ ...card, ...cardData });
    if (gameState.cardHistory.length > 10) {
        gameState.cardHistory.pop();
    }

    // Apply effects
    applyCardEffects(cardData);

    // Clear pending card
    gameState.pendingCard = null;

    // Update displays
    updateHistoryDisplay();

    // Clear the card display
    document.getElementById('cardResult').innerHTML = 'No card drawn yet';

    saveGameState();
}

function displayCard(card, cardData) {
    const suitSymbols = {
        'spades': '♠️',
        'hearts': '♥️',
        'diamonds': '♦️',
        'clubs': '♣️'
    };

    const display = document.getElementById('cardResult');

    // Build effects preview
    let effectsHTML = '';
    if (cardData.tokens !== 0) {
        effectsHTML += `<p><strong>Effect: ${cardData.tokens > 0 ? '+' : ''}${cardData.tokens} Tokens</strong></p>`;
    }
    if (cardData.blocks > 0) {
        effectsHTML += `<p><strong>Effect: Pull ${cardData.blocks} block(s)</strong></p>`;
    }

    display.innerHTML = `
        <div style="border: 3px solid var(--color-accent_primary); border-radius: 8px; padding: 15px; background: rgba(42, 31, 20, 0.9);">
            <h3 style="margin-bottom: 10px;">${suitSymbols[card.suit]} ${card.value} - ${cardData.title}</h3>
            <div style="margin: 15px 0; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                <p style="line-height: 1.6; white-space: pre-wrap;">${cardData.description}</p>
            </div>
            ${effectsHTML}
            <div style="margin-top: 15px; text-align: center;">
                <button
                    onclick="applyCurrentCard()"
                    style="width: 100%; background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); font-size: 1.1em; padding: 15px;"
                    aria-label="Apply card effects and add to journal">
                    ✓ Apply Card Effects
                </button>
            </div>
            <p style="margin-top: 10px; font-size: 0.9em; font-style: italic; color: var(--color-text_secondary); text-align: center;">
                Read the prompt and write in your journal before applying effects
            </p>
        </div>
    `;
}

function applyCardEffects(cardData) {
    // Apply token changes
    if (cardData.tokens) {
        gameState.tokens += cardData.tokens;
        updateTokenDisplay();
    }
    
    // Handle block pulls
    if (cardData.blocks > 0) {
        for (let i = 0; i < cardData.blocks; i++) {
            pullBlock();
        }
    }
    
    // Check win/loss conditions
    checkGameEnd();
}

// Stability/Tower mechanics
function pullBlock() {
    if (gameState.stability <= 0) return;
    
    const thresholds = GAME_CONFIG.mechanics.stability.thresholds;
    let failureThreshold = 1;
    
    if (gameState.stability <= thresholds.critical) {
        failureThreshold = 3;
    } else if (gameState.stability <= thresholds.danger) {
        failureThreshold = 2;
    }
    
    // Roll dice pool
    let lost = 0;
    for (let i = 0; i < gameState.stability; i++) {
        if (Math.random() * 6 + 1 <= failureThreshold) {
            lost++;
        }
    }
    
    gameState.stability -= lost;
    if (gameState.stability < 0) gameState.stability = 0;
    
    updateStabilityDisplay();
    
    if (gameState.stability === 0) {
        endGame('stability');
    }
}

// Token management
function adjustTokens(amount) {
    gameState.tokens += amount;
    updateTokenDisplay();
    saveGameState();
}

// Display updates
function updateTokenDisplay() {
    const tokenName = GAME_CONFIG.mechanics.tokens.name;
    document.getElementById('tokenValue').textContent = gameState.tokens;
    document.getElementById('tokenName').textContent = tokenName;
}

function updateStabilityDisplay() {
    const stabilityName = GAME_CONFIG.mechanics.stability.name;
    const maxStability = GAME_CONFIG.mechanics.stability.initial;
    document.getElementById('stabilityValue').textContent = gameState.stability;
    document.getElementById('stabilityName').textContent = stabilityName;

    const thresholds = GAME_CONFIG.mechanics.stability.thresholds;
    let className = 'stability-safe';
    if (gameState.stability <= thresholds.critical) {
        className = 'stability-critical';
    } else if (gameState.stability <= thresholds.danger) {
        className = 'stability-danger';
    }

    document.getElementById('stabilityValue').className = className;

    // Update visual bar
    const barElement = document.getElementById('stabilityBar');
    if (barElement) {
        const percentage = (gameState.stability / maxStability) * 100;
        barElement.style.width = percentage + '%';

        // Update bar color class
        barElement.className = 'stability-fill';
        if (gameState.stability <= thresholds.critical) {
            barElement.className = 'stability-fill critical';
        } else if (gameState.stability <= thresholds.danger) {
            barElement.className = 'stability-fill danger';
        }
    }
}

function updateDeckDisplay() {
    document.getElementById('deckCount').textContent = gameState.deck.length;
}

function updateHistoryDisplay() {
    const history = document.getElementById('cardHistory');
    const suitSymbols = {
        'spades': '♠️',
        'hearts': '♥️',
        'diamonds': '♦️',
        'clubs': '♣️'
    };
    
    history.innerHTML = gameState.cardHistory
        .map(card => `<div class="history-item">${suitSymbols[card.suit]} ${card.value} - ${card.title}</div>`)
        .join('');
}

// Game end conditions
function checkGameEnd() {
    const conditions = GAME_CONFIG.conditions;
    
    // Check loss conditions
    if (gameState.stability <= 0) {
        endGame('stability');
        return;
    }
    
    if (gameState.tokens <= 0) {
        endGame('tokens');
        return;
    }
    
    // Check win condition
    if (gameState.deck.length === 0 && gameState.tokens > 0 && gameState.stability > 0) {
        endGame('win');
    }
}

function endGame(reason) {
    gameState.gameEnded = true;
    
    const conditions = GAME_CONFIG.conditions;
    let message = '';
    
    if (reason === 'win') {
        const winCondition = conditions.win.find(c => c.type === 'deck_empty');
        message = winCondition.message;
    } else if (reason === 'stability') {
        const loseCondition = conditions.lose.find(c => c.type === 'stability_zero');
        message = loseCondition.message || 'Game Over: Stability collapsed';
    } else if (reason === 'tokens') {
        const loseCondition = conditions.lose.find(c => c.type === 'tokens_zero');
        message = loseCondition.message || 'Game Over: All resources lost';
    }
    
    document.getElementById('cardResult').innerHTML = `
        <div class="game-end">
            <h2>Game Over</h2>
            <p>${message}</p>
            <button onclick="newGame()">New Game</button>
        </div>
    `;
    
    document.querySelectorAll('button:not([onclick*="newGame"])').forEach(btn => {
        btn.disabled = true;
    });
}

// Save/Load
function saveGameState() {
    localStorage.setItem('gameState', JSON.stringify(gameState));
    localStorage.setItem('journalContent', document.getElementById('journal').value);
}

function loadGameState() {
    const saved = localStorage.getItem('gameState');
    if (saved) {
        gameState = JSON.parse(saved);
        updateTokenDisplay();
        updateStabilityDisplay();
        updateDeckDisplay();
        updateHistoryDisplay();

        // Restore pending card if exists
        if (gameState.pendingCard) {
            displayCard(gameState.pendingCard.card, gameState.pendingCard.cardData);
        }

        if (gameState.gameEnded) {
            document.querySelectorAll('button:not([onclick*="newGame"])').forEach(btn => {
                btn.disabled = true;
            });
        }
    }

    const journal = localStorage.getItem('journalContent');
    if (journal) {
        document.getElementById('journal').value = journal;
    }
}

function newGame() {
    if (confirm('Start a new game? This will erase all progress.')) {
        localStorage.clear();
        location.reload();
    }
}

// Journal auto-save
let saveTimeout;
function autoSaveJournal() {
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
        saveGameState();
    }, 1000);
}

function downloadJournal() {
    const text = document.getElementById('journal').value;
    const blob = new Blob([text], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `journal-${new Date().toISOString().slice(0,10)}.txt`;
    a.click();
    URL.revokeObjectURL(a.href);
}

// Initialize on load
window.onload = function() {
    initializeDeck();
    loadGameState();
    updateTokenDisplay();
    updateStabilityDisplay();
    
    document.getElementById('journal').addEventListener('input', autoSaveJournal);
};

    </script>
</body>
</html>